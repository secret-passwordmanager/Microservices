<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>

  </head>
  <body>
   <input type="text" name="trustedJWT" value="trustedJWT" id="jwt">
   <input type="text" value="masterCred" id="masterCred">
   <button id="connect">Connect</button>
   <button id="getSwap">Get Swaps </button>
   <button id="submitSwapBtn">Submit Swap</button>
   <input  id="credId" type="text" value="credId">
   <input id="jwt" type="text">
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var swap = null;

      document.getElementById('connect').addEventListener('click', () => {
         var socket = io.connect('/Trusted', {
         query: { 
            'jwt': document.getElementById("jwt").value,
            'masterCred': document.getElementById("masterCred").value
         }
         });
         socket.on('connection', (error) => {
            console.log('connected')
         });
         socket.on('connectionNew', (role) => {
            console.log(role);
         });
         socket.on('connectionDisconnect', () => {
            console.log('Untrusted device disconnected');
         });

         socket.on('swapNew', (swap) => {
         
            console.log('------- New Swap -------------');
            console.log('Swap User Id: ' + swap.userId);
            console.log('Swap domain: ' +  swap.domain);
            console.log('Swap token: ' + swap.token);
            console.log('Swap AuthId: ' + swap.authId);
            console.log('-------------------------------');

            console.log('New Swap Available');
         });
         socket.on('swapGot', (swaps) => {
            if (swaps.length == 0 ) {
               console.log('No pending swaps');
            } else {
               swaps.forEach(swap => {
                  console.log('-------------------------------');
                  console.log('Swap user Id: ' + swap.userId);
                  console.log('Swap user IP: ' + swap.ip);
                  console.log('Swap type: ' + swap.type);
                  console.log('Swap domain: ' +  swap.domain);
                  console.log('Swap token: ' + swap.token);
                  console.log('Swap AuthId: ' + swap.authId);
                  console.log('-------------------------------');
               });
               swap = swaps[0];
            }
         });

         socket.on('err', (error) => {
            console.log('There was a problem: ' + error);
         });


         document.getElementById('getSwap').addEventListener('click', () => {
            socket.emit('swapGet');
         });
         document.getElementById('submitSwapBtn').addEventListener('click', () => {
            console.log(swap);
            swap.credId = parseInt(document.getElementById('credId').value, 10);
            socket.emit('swapApprove', swap);
         });
      })

      

    </script>

  </body>
</html>