<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>

  </head>
  <body>
   <button id="getSwap">Get Swaps </button>
   <button id="submitSwapBtn">Submit Swap</button>
   <input  id="credId" type="text" value="credId">
   <input id="swapId" type="text" value="swapId">
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var swap = null;
      let jwt = 'eyJhbGciOiJSUzI1NiIsImtpZCI6Ik9vQ3VjWEFYTXFIbWZlWnpsbzJNTTdldXIyc3ZVb3V3OVNTRUpONmZJREkifQ.eyJ1bmlxdWVfbmFtZSI6IjI3IiwicmVmcmVzaFRva2VuIjoicW5RczdKaEREdWJDeVNZOWxZNmFBZDE5NFZMQU9EZ2tjeDNqNTJyTW1VeXhTWXhWVFZFYXpwVXVJSEg3RU9HVVo4Z3hoNUI3Y0ZMOGpQWEVtU1BIU1E9PSIsInJvbGUiOiJUcnVzdGVkIiwic3ViIjoiMjciLCJhdWQiOiJCT1VOQ0VSIiwiaXNzIjoiQk9VTkNFUiIsImlhdCI6MTU5ODk3NTI1NCwiZXhwIjoxNTk5MDA1MjU0fQ.HOD3cn6natTXXdC4bk2-nsO9eMHvKx_UOPbmAVOQRV9FdbHLDPduknh_LwEnpTkQxZC0FGE51WmD83mRQRv51Lijx97eZi5eu00nH64KVxkWNptt_MUgIp40gh8dq2MD04iAATrQ10D1yfM4T0l3MyEO6NJOsiXSA2143c8Vb-fkDmCllYfz06OlcL9dHXlMEicwBXtIAQqHptAkIGRRknw3mzXAF6KT70OHDrhnPRCIKoVzvgxQCgrbR3RbbTNtzJqcM_BqgdGzd1auUlS3v_olqFluBaXF5lPs_67N_Rp4HDebLHfJhNSfC3B70neuXQ4Yq-bd0ePuikn0oXecyw';
      var socket = io.connect('/Trusted', {
         query: { 
            'jwt': jwt,
            'masterCred': 'YopSrbkEPGFmQPW'
         }
      });
      socket.on('connection', (error) => {
         console.log('connected')
      });
      socket.on('connectionNew', (role) => {
         console.log(role);
      });
      socket.on('connectionDisconnect', () => {
         console.log('Untrusted device disconnected');
      });

      socket.on('swapNew', (swap) => {
        
         console.log('------- New Swap -------------');
         console.log('Swap User Id: ' + swap.userId);
         console.log('Swap domain: ' +  swap.domain);
         console.log('Swap token: ' + swap.token);
         console.log('Swap AuthId: ' + swap.authId);
         console.log('-------------------------------');

         console.log('New Swap Available');
      })
      socket.on('swapGot', (swaps) => {
         if (swaps.length == 0 ) {
            console.log('No pending swaps');
         } else {
            swaps.forEach(swap => {
               console.log('-------------------------------');
               console.log('Swap user Id: ' + swap.userId);
               console.log('Swap user IP: ' + swap.ip);
               console.log('Swap domain: ' +  swap.domain);
               console.log('Swap token: ' + swap.token);
               console.log('Swap AuthId: ' + swap.authId);
               console.log('-------------------------------');
            });
            swap = swaps[0];
         }
      });

      socket.on('err', (error) => {
         console.log('There was a problem: ' + error);
      });

      document.getElementById('getSwap').addEventListener('click', () => {
         socket.emit('swapGet');
      });
      document.getElementById('submitSwapBtn').addEventListener('click', () => {
         console.log(swap);
         swap.credId = parseInt(document.getElementById('credId').value, 10);
         socket.emit('swapApprove', swap);
      });
    </script>

  </body>
</html>