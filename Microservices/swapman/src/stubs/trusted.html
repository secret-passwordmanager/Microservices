<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>

  </head>
  <body>
   <input type="text" name="trustedJWT" value="eyJhbGciOiJSUzI1NiIsImtpZCI6IlNUZ29iWnRlM09jMmVRYUgyS2RBbXdXSFhsTFVXcXNzdXpMZXRrMjRLU1EifQ.eyJ1bmlxdWVfbmFtZSI6IjE2IiwibG9naW5JZCI6IjViYzQ4ZDQzZTAwZGQ3Yjc2NThkOGRiMTczZmFiZjAwIiwicm9sZSI6IlRydXN0ZWQiLCJtYXN0ZXJDcmVkIjoidERscVduZ1FaMWM3N3ZRIiwic3ViIjoiMTYiLCJhdWQiOiJCT1VOQ0VSIiwiaXNzIjoiQk9VTkNFUiIsImlhdCI6MTYwMDcyNDY2OCwiZXhwIjoxNjAwNzU0NjY4fQ.ZTP5ompcXnalqgIfiO5L_6lJ5PrqJeQ_B9IfyJIiriO80tT5NfszqGXnk8Wuvj0POOyRTQJZ6PUBRgptQF9iz8jMEzrZZahucQbYk1NYL5Wt5bzxsjQoZ35EyHyAaqgelI5Qjj_3it-p-vw-_feeTeFe3YjPOAeP0oPTpl53NpzwUkCRF8rygpMtNgoWNgy6BHzOTEhdGfJMdmKdK5glJtne0UZnnosBEOB5-GU1kxH75yTvkZDUIu04mwKSdiVSGDsByKJi9DRzDuzsUVozMfNOKWO9L0r4p9xZeVnBLARFkK11bihrs2RaAPykhmUsiLthbYr-50p4S96OV2Lrrw" id="jwt">
   <button id="connect">Connect</button>
   <button id="getSwap">Get Swaps </button>

   <input  id="credId" type="text" value="credId">
   <button id="submitSwapBtn">Submit Swap</button>
   <button id="deleteSwapBtn">Delete Swap</button>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var swap = null;

      document.getElementById('connect').addEventListener('click', () => {
         var socket = io.connect('/Trusted', {
            query: { 
               'jwt': document.getElementById("jwt").value
            }
         });
         socket.on('connection', (error) => {
            console.log('connected')
         });
         socket.on('connectionNew', (role) => {
            console.log(role);
         });
         socket.on('connectionDisconnect', () => {
            console.log('Untrusted device disconnected');
         });

         socket.on('swapNew', (swap) => {
         
            console.log('------- New Swap -------------');
            console.log('Swap User Id: ' + swap.userId);
            console.log('Swap domain: ' +  swap.domain);
            console.log('Swap token: ' + swap.token);
            console.log('Swap AuthId: ' + swap.authId);
            console.log('-------------------------------');

            console.log('New Swap Available');
         });
         socket.on('swapGot', (swaps) => {
            if (swaps.length == 0 ) {
               console.log('No pending swaps');
            } else {
               swaps.forEach(swap => {
                  console.log('-------------------------------');
                  console.log('Swap user Id: ' + swap.userId);
                  console.log('Swap user IP: ' + swap.ip);
                  console.log('Swap type: ' + swap.type);
                  console.log('Swap domain: ' +  swap.domain);
                  console.log('Swap token: ' + swap.token);
                  console.log('Swap AuthId: ' + swap.authId);
                  console.log('-------------------------------');
               });
               swap = swaps[0];
            }
         });

         socket.on('err', (error) => {
            console.log('There was a problem: ' + error);
         });


         document.getElementById('getSwap').addEventListener('click', () => {
            socket.emit('swapGet');
         });
         document.getElementById('submitSwapBtn').addEventListener('click', () => {
            console.log(swap);
            swap.credId = parseInt(document.getElementById('credId').value, 10);
            socket.emit('swapApprove', swap);
         });


         document.getElementById('deleteSwapBtn').addEventListener('click', () => {
            socket.emit('swapDelete', swap);
         })
      })

      

    </script>

  </body>
</html>